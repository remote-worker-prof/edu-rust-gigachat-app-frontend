# Учебная инструкция: сборка и запуск UI

Документ предназначен для студентов и написан в объяснительном стиле. Он
поясняет основные термины и практики, которые используются при сборке и
запуске веб‑интерфейса на Rust.

## 1. Что именно собирается

**UI (User Interface)** — это клиентская часть приложения, которая
работает в браузере. UI общается с сервером по HTTP‑API. В данном проекте
сервер — это `rust-gigachat-app`, а клиент — `rust-gigachat-webapp`.

Ключевое следствие: UI и сервер — **два разных процесса**, которые
запускаются отдельно и обычно слушают **разные порты**.

## 2. Базовые термины (простыми словами)

### 2.1. Frontend и Backend

- **Frontend** — код, который выполняется в браузере пользователя.
- **Backend** — серверная часть, которая принимает запросы и возвращает
  ответы (JSON, текст и т.д.).

В этом проекте:
- frontend — `rust-gigachat-webapp`,
- backend — `rust-gigachat-app`.

### 2.2. API (Application Programming Interface)

**API** — это набор правил и URL‑адресов, по которым frontend может
обращаться к backend. В нашем случае:
- `GET /health` — проверка доступности,
- `POST /ask` — отправка вопроса.

### 2.3. localhost и порт

- **localhost** (или `127.0.0.1`) — это адрес текущего компьютера.
- **Порт** — номер, который различает разные серверы на одном адресе.

Пример:
- `http://127.0.0.1:8000` — backend,
- `http://127.0.0.1:8080` — frontend.

### 2.4. WebAssembly (WASM)

**WebAssembly** — формат байткода, который браузер может исполнять так же,
как JavaScript. Код на Rust компилируется в WASM, а затем запускается в
браузере.

### 2.5. Target (цель компиляции)

**Target** — это платформа, для которой компилируется код. Для браузера
используется цель `wasm32-unknown-unknown`.

### 2.6. Trunk

**Trunk** — инструмент сборки для приложений на Yew. Он:
- компилирует Rust в WASM,
- собирает статические файлы,
- запускает локальный сервер для разработки.

### 2.7. Переменные окружения

**Переменная окружения** — параметр, который задаётся до запуска команды.
В проекте используется `API_BASE_URL`, чтобы указать адрес backend.

Пример:

```bash
API_BASE_URL=http://127.0.0.1:8000 NO_COLOR=true trunk serve --address 127.0.0.1 --port 8080
```

### 2.8. Затравочная проверка

**Затравочная проверка** — минимальная проверка, которая подтверждает, что
приложение **собирается** и **запускается**, а базовый экран отображается.
Это не полноценное тестирование, а быстрый «санитарный» запуск.

## 3. Требования к окружению

Необходимо наличие:

- Rust (stable)
- Цель компиляции WebAssembly: `wasm32-unknown-unknown`
- Trunk

Установка:

```bash
rustup target add wasm32-unknown-unknown
cargo install trunk
```

## 4. Запуск backend (серверной части)

Backend запускается отдельно, в своём терминале:

```bash
cd /home/sorcerer/Projects/rust-gigachat-app
cargo run
```

По умолчанию сервер слушает `http://127.0.0.1:8000`.

## 5. Запуск UI (frontend)

UI запускается во втором терминале:

```bash
cd /home/sorcerer/Projects/rust-gigachat-webapp
NO_COLOR=true trunk serve --address 127.0.0.1 --port 8080
```

После запуска открыть в браузере:

```
http://127.0.0.1:8080
```

### Почему используется `NO_COLOR=true`

Иногда в окружении есть переменная `NO_COLOR=1`. Trunk ожидает строго
`true/false` и может завершиться ошибкой. Поэтому рекомендуется явно
указывать:

```bash
NO_COLOR=true
```

## 6. Сборка (без запуска сервера)

Сборка полезна, когда нужно получить статические файлы:

```bash
NO_COLOR=true trunk build
```

Результат будет помещён в директорию `dist/`.

## 7. Затравочная проверка (минимальная)

1. Запустить backend.
2. Запустить UI.
3. Открыть браузер и убедиться, что:
   - виден экран с формой вопроса,
   - есть блок «Статус API».

Дополнительно можно нажать «Проверить» в блоке статуса.

## 8. Настройка `API_BASE_URL`

Базовый URL можно задавать двумя способами:

1. **Через переменную окружения при запуске**:

```bash
API_BASE_URL=http://127.0.0.1:8000 NO_COLOR=true trunk serve --address 127.0.0.1 --port 8080
```

2. **Через интерфейс**: поле «Базовый URL API» в UI.
   Значение сохранится в `localStorage` браузера.

## 9. Частые ошибки и их смысл

Подробности см. в `docs/common_issues.md`. Ключевые примеры:

- Backend не запущен → UI не сможет получить статус.
- Неверный порт → запросы идут «не туда».
- Ошибка `invalid value '1' for '--no-color'` → нужна переменная
  `NO_COLOR=true`.

## 10. Что важно запомнить

- Frontend и backend запускаются **отдельно**.
- Для браузера нужен **WASM target**.
- Trunk — основной инструмент сборки UI.
- `API_BASE_URL` задаёт адрес сервера.
- Затравочная проверка — это минимальный контроль «всё стартует».
